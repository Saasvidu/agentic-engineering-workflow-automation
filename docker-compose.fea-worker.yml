version: "3.8"

services:
  abaqus-engine:
    image: abaqusregistry.azurecr.io/abaqus_2024_le:v6-run-png-with-script
    container_name: abaqus_engine
    platform: linux/amd64
    shm_size: "2gb"
    ports:
      - "6901:6901"
      - "5000:5000"
    environment:
      - VNC_PW=password
    volumes:
      - ./shared_data:/home/kasm_user/work
    restart: unless-stopped

  fea-worker:
    build:
      dockerfile: Dockerfile.fea-worker
    container_name: fea_worker
    depends_on:
      - abaqus-engine
    env_file:
      - ./services/fea-worker/.env
    volumes:
      - ./shared_data:/app/jobs
    tty: true
    stdin_open: true
    restart: on-failure
